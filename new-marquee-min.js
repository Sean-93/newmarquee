const RTL_LANGUAGES=["ar","he","fa","ur","yi","ps","dv","ug","syr"];class NewMarquee extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                .marquee-container {
                    display: block;
                    max-width: 100%;
                    margin: 0 auto;
                    overflow: hidden;
                    width: 100%;
                    height: 100%; /* FOR VERTICAL SCROLLING */
                }
                #marquee-content {
                    white-space: nowrap;
                    will-change: transform;
                    display: inline-block;
                }
            </style>
            <section class="marquee-container">
                <div id="marquee-content">
                    <slot></slot> <!-- PLACEHOLDER FOR USER CONTENT -->
                </div>
            </section>
        `,this.marqueeContent=this.shadowRoot.querySelector("#marquee-content")}connectedCallback(){this.ensureImagesLoaded(()=>{this.setDefaultDirection(),this.animateMarquee(),this.resizeListener=this.animateMarquee.bind(this),window.addEventListener("resize",this.resizeListener),"true"===this.getAttribute("pauseonhover")&&this.addHoverListeners()}),this.observer=new MutationObserver(()=>{this.languageChangeTimeout&&clearTimeout(this.languageChangeTimeout),this.languageChangeTimeout=setTimeout(()=>this.setDefaultDirection(),100)}),this.observer.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"]})}disconnectedCallback(){this.resizeListener&&window.removeEventListener("resize",this.resizeListener),"true"===this.getAttribute("pauseonhover")&&this.removeHoverListeners(),this.currentAnimation&&(this.currentAnimation.cancel(),this.currentAnimation=null),this.progressUpdateInterval&&clearInterval(this.progressUpdateInterval),this.observer&&this.observer.disconnect()}ensureImagesLoaded(e){let t=this.querySelectorAll("img"),r=Array.from(t).map(e=>new Promise(t=>{e.complete&&0!==e.naturalHeight?t():e.addEventListener("load",t,{once:!0})}));Promise.all(r).then(e).catch(e=>{console.error("Error loading images:",e)})}setDefaultDirection(){let e=document.documentElement.lang,t=this.getAttribute("direction");!RTL_LANGUAGES.includes(e)||t&&["left","right","up","down"].includes(t)||this.setAttribute("direction","right")}animateMarquee=()=>{let e=this.marqueeContent.scrollWidth,t=this.marqueeContent.scrollHeight,r=this.shadowRoot.querySelector(".marquee-container"),i=r.offsetWidth,n=r.offsetHeight,s=parseInt(this.getAttribute("speed"),10)||50,a=this.getAttribute("direction")||"left",o="true"===this.getAttribute("persistent")?.trim().toLowerCase(),h=`${this.tagName.toLowerCase()}-state`,u=0,m=0;if(o){let l;try{(l=localStorage.getItem(h))&&(l=JSON.parse(l))}catch(c){console.error("Error parsing saved state:",c),l=null}l&&(u=parseFloat(l.time),m=parseFloat(l.timestamp))}let d,g;switch(a){case"right":d=e/s,g=[{transform:`translateX(-${e}px)`},{transform:`translateX(${i}px)`}];break;case"up":d=t/s,g=[{transform:`translateY(${n}px)`},{transform:`translateY(-${t}px)`}];break;case"down":d=t/s,g=[{transform:`translateY(-${t}px)`},{transform:`translateY(${n}px)`}];break;default:d=e/s,g=[{transform:`translateX(${i}px)`},{transform:`translateX(-${e}px)`}]}let p=this.marqueeContent.animate(g,{duration:1e3*d,iterations:1/0});if(o){if(isFinite(u)){let $=Date.now(),v=Math.max(0,$-m),L=(u+v)%(1e3*d);p.currentTime=L}let f=(()=>{let e=0;return()=>{let t=Date.now();if(t-e>=Math.min(100*d,1e3)){e=t;let r=p.currentTime%(1e3*d);localStorage.setItem(h,JSON.stringify({time:r,timestamp:Date.now()}))}}})();this.progressUpdateInterval=setInterval(f,500)}this.currentAnimation=p};addHoverListeners(){this.pauseAnimation=()=>{this.currentAnimation&&this.currentAnimation.pause()},this.resumeAnimation=()=>{this.currentAnimation&&this.currentAnimation.play()},this.marqueeContent.addEventListener("mouseenter",this.pauseAnimation),this.marqueeContent.addEventListener("mouseleave",this.resumeAnimation)}removeHoverListeners(){this.marqueeContent.removeEventListener("mouseenter",this.pauseAnimation),this.marqueeContent.removeEventListener("mouseleave",this.resumeAnimation)}}customElements.define("new-marquee",NewMarquee);